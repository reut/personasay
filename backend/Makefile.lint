# Code Quality Makefile for PersonaSay Backend
# Run linters and formatters

.PHONY: help format lint check test clean

help:
	@echo "PersonaSay Backend - Code Quality Commands"
	@echo ""
	@echo "  make format    - Format code with black and isort"
	@echo "  make lint      - Run all linters (flake8, pylint, mypy)"
	@echo "  make check     - Check code without changing (black --check, isort --check)"
	@echo "  make test      - Run tests with pytest"
	@echo "  make clean     - Remove cache files"
	@echo "  make all       - Format, lint, and test"
	@echo ""

# Format code
format:
	@echo "ðŸŽ¨ Formatting code with black..."
	@black app/ tests/
	@echo ""
	@echo "ðŸ“¦ Sorting imports with isort..."
	@isort app/ tests/
	@echo ""
	@echo "âœ… Code formatting complete!"

# Check formatting without changes
check:
	@echo "ðŸ” Checking code format with black..."
	@black --check app/ tests/
	@echo ""
	@echo "ðŸ” Checking import order with isort..."
	@isort --check-only app/ tests/
	@echo ""
	@echo "âœ… Code format check complete!"

# Run linters
lint:
	@echo "ðŸ” Running flake8..."
	@flake8 app/ tests/ || true
	@echo ""
	@echo "ðŸ” Running pylint..."
	@pylint app/ || true
	@echo ""
	@echo "ðŸ” Running mypy..."
	@mypy app/ || true
	@echo ""
	@echo "âœ… Linting complete!"

# Run tests
test:
	@echo "ðŸ§ª Running tests with pytest..."
	@pytest tests/ -v

# Clean cache files
clean:
	@echo "ðŸ§¹ Cleaning cache files..."
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@find . -type d -name ".mypy_cache" -exec rm -rf {} + 2>/dev/null || true
	@find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true
	@find . -type f -name "*.pyc" -delete 2>/dev/null || true
	@rm -rf htmlcov/ .coverage
	@echo "âœ… Clean complete!"

# Run everything
all: format lint test
	@echo ""
	@echo "âœ… All checks complete!"

